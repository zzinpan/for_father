<!DOCTYPE html>
<html>
<head>
<meta charset=UTF-8">
<title>신나라유통 ERP > product > management</title>
<link rel="stylesheet" href="/lib/jquery-ui-1.12.1/jquery-ui.min.css">
<link rel="stylesheet" href="/lib/bootstrap/bootstrap.min.css">
<style type="text/css">
body { margin: 0px; padding: 0px; overflow: hidden; font-family: sans-serif; color: #616161; }
.smc-btn { float: right; display: inline-block; padding: 4px 10px; vertical-align: bottom; font-weight: bold; font-size: 10px; box-shadow: 0px 0px 0px 1px #ccc; border-radius: 4px; cursor: pointer; margin-left: 4px; }
.smc-btn:not(.disable):hover { box-shadow: 0px 0px 1px 1px #aaa; !important; }
.smc-btn.select { box-shadow: 0px 0px 1px 1px #2196F3 !important; }
.smc-btn.blue { background-color: #2196F3; color: white; box-shadow: 0px 0px 0px 1px #2196F3; }
.smc-btn.bluegray { background-color: #607D8B; color: white; box-shadow: 0px 0px 0px 1px #90A4AE; }
.smc-btn.disable { background-color: #eee; color: #aaa; cursor: not-allowed; }
.smc-header { font-size: 20px; padding: 10px; color: #222; font-weight: bold; margin-bottom: 20px; }
.smc-desc { background-color: #eee; color: #616161; padding: 10px; font-size: 12px; }
.smc-inp { border: none; border-bottom: #ccc solid 1px; padding: 4px 10px; font-size: 10px; width: 100%; }
.smc-inp::placeholder { color: #cccccc; }
.smc-inp:focus { outline: none; border-bottom: #2196F3 solid 1px; }
.smc-count { font-size: 10px; height: 28px; }
.smc-grid { position: relative; box-shadow: 0px 0px 0px 1px #ccc; height: calc( 100% - 67px ); border-radius: 4px; }
.small-title { font-weight: bold; margin-bottom: 40px; }
.smc-select { width: 100px; border: #ccc solid 1px; padding-left: 4px; border-radius: 4px; font-size: 12px; }

.popup-row { float: left; width: 100%; }
.mt6 { margin-top: 6px; }
.mt10 { margin-top: 10px; }
.mt20 { margin-top: 20px; }

/* 그룹 */
.product-group-list { position: relative; text-align: center; background-color: ; height: calc( 100% - 37px ); overflow: auto; padding: 0px; }
	.product-group-header { background-color: #4FC3F7; color: white; font-weight: bold; height: 37px; text-align: center; }
	.product-group-item { position: relative; cursor: pointer; width: 100%; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; user-select: none; z-index: 0; }
	.product-group-list .product-group-item:nth-child(2n) { background-color: #f8f8f8; }
	.product-group-list .product-group-item:last-child { border-bottom: #eee solid 2px; }
	.product-group-item:hover { box-shadow: 0px 0px 0px 1px #aaa !important; z-index: 1; }
	.product-group-item.select { box-shadow: 0px 0px 0px 1px #2196F3 !important; z-index: 2; }
	.product-group-item.unuse { color: #ccc !important; }
		
		.product-group-order { display: inline-block; float: left; padding: 10px 0px; font-size: 12px; width: 50px; margin: 0px; }
		.product-group-name { display: inline-block; float: left; padding: 10px 0px; font-size: 12px; width: calc( 100% - 300px ); margin: 0px; }
		.product-group-use { display: inline-block; float: left; padding: 10px 0px; font-size: 12px; width: 70px; }
		.product-group-regdate { display: inline-block; float: left; padding: 10px 0px; font-size: 12px; width: 90px; }
		.product-group-update { display: inline-block; float: left; padding: 10px 0px; font-size: 12px; width: 90px; }
		.product-group-item.disable { background-color: #eee; }
		.product-group-content-list { padding: 10px 0px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }
			.product-group-content-item { padding: 4px 0px; height: 25px; font-size: 12px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }
				.product-group-property { float: left; width: 69px; text-align: center; border-right: #ccc solid 1px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }
				.product-group-value { float: left; width: 110px; text-align: center; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }
		.product-group-content-use-status { padding: 0px; border-top: #ccc solid 1px; text-align: center; font-size: 10px; white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }
		.product-group-content-use-status.use { background-color: #E8F5E9; }
		.product-group-content-use-status.unuse { background-color: #eee; }
		
/* 품목 컬럼 */
.product-column-list { box-shadow: 0px 0px 0px 1px #ccc; border-radius: 4px; font-size: 0px; overflow-x: auto; white-space: nowrap; text-align: center; margin-bottom: 40px; width: 100%; height: 60px; }
	.product-column-parent { position: relative; display: inline-block; font-size: 12px; height: 60px; background-color: #eee; box-shadow: 0px 0px 0px 1px #ccc; vertical-align: top; }
		.product-column-parent-name { position: relative; padding: 21px 10px 22px 10px; }
		.has-children > .product-column-parent-name { padding: 6px 10px 7px 10px; }
		.product-column-children { display: inline-block; padding: 7px 10px 6px 10px; box-shadow: 1px -1px 0px 0px #ccc; }
		.product-column-parent .product-column-children:last-child { display: inline-block; padding: 7px 10px 6px 10px; box-shadow: 0px -1px 0px 0px #ccc; }
		
/* 라이브러리 커스텀 */		
.ui-autocomplete.ui-widget {
	font-size: 10px;
}
</style>
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="/lib/jquery-ui-1.12.1/jquery-ui.min.js"></script>
<script src="/lib/bootstrap/bootstrap.min.js"></script>
<script type="text/javascript">
/**
 	Polyfill
 **/
if (!String.prototype.padStart) {
    String.prototype.padStart = function padStart(targetLength,padString) {
        targetLength = targetLength>>0; //truncate if number or convert non-number to 0;
        padString = String((typeof padString !== 'undefined' ? padString : ' '));
        if (this.length > targetLength) {
            return String(this);
        }
        else {
            targetLength = targetLength-this.length;
            if (targetLength > padString.length) {
                padString += padString.repeat(targetLength/padString.length); //append to original to ensure we are longer than needed
            }
            return padString.slice(0,targetLength) + String(this);
        }
    };
}
</script>
</head>
<body>
<div class="container" style="position: relative; height: 100%;">
	<div class="row" style="position: relative; margin-top: 50px; height: calc( 100% - 50px );">
		<div class="ccol-md-12" style="position: relative; height: 100%;">
			<div class="smc-header">
				품목 관리
			</div>
			
			
			<div class="col-md-12" style="position: relative; height: calc( 100% - 68px );">
				
				
					<div class="col-md-12" style="height: 32px;">
						<div class="col-md-6">
							<div style="display: inline-block; font-size: 12px; font-weight: bold;">품목 미리보기</div>
						</div>
						<div class="col-md-6">
							<div id="save-btn" class="smc-btn blue">저장</div>
						</div>
					</div>
				<div class="col-md-12" style="position: relative;">
					<div id="product-column-list" class="product-column-list">
					</div>
				</div>
				
				
				<!-- 품목그룹 -->
				<div class="col-md-6" style="position: relative; height: calc( 100% - 172px );">
					<!-- 상단 -->
					<div class="smc-count">
						<div class="col-md-4" style="padding-top: 8px;">총 <span id="product-group-cnt-span">0</span>건</div>
						<div class="col-md-8">
							<div class="smc-btn-wrap">
								<div id="del-product-group-btn" class="smc-btn disable">삭제</div>
								<div id="mod-product-group-btn" class="smc-btn disable">수정</div>
								<div id="add-product-group-btn" class="smc-btn">추가</div>
							</div>
						</div>
					</div>
					
					<div class="smc-grid">
					
						<div class="product-group-header">
							<div class="product-group-order">순서</div>
							<div class="product-group-name">품목그룹명</div>
							<div class="product-group-use">사용여부</div>
							<div class="product-group-regdate">등록일</div>
							<div class="product-group-update">수정일</div>
						</div>
						<!-- 본문 -->
						<div id="product-group-list" class="col-md-12 product-group-list">
							
						</div>
					</div>
					
				</div>
				
				
				<!-- 품목 -->
				<div class="col-md-6" style="position: relative; height: calc( 100% - 172px );">
					<!-- 상단 -->
					<div class="smc-count">
						<div class="col-md-3" style="padding-top: 8px;">총 <span id="product-cnt-span">0</span>건</div>
						<div class="col-md-9">
							<div class="smc-btn-wrap">
								<div id="del-product-btn" class="smc-btn disable">삭제</div>
								<div id="mod-product-btn" class="smc-btn disable">수정</div>
								<div id="export-product-btn" class="smc-btn disable">품목그룹으로 내보내기</div>
								<div id="import-product-btn" class="smc-btn disable">품목으로 가져오기</div>
								<div id="add-product-btn" class="smc-btn disable">추가</div>
							</div>
						</div>
					</div>
					
					<div class="smc-grid">
					
						<div class="product-group-header">
							<div class="product-group-order">순서</div>
							<div class="product-group-name">품목명</div>
							<div class="product-group-use">사용여부</div>
							<div class="product-group-regdate">등록일</div>
							<div class="product-group-update">수정일</div>
						</div>
						<!-- 본문 -->
						<div id="product-list" class="col-md-12 product-group-list">
							
						</div>
					</div>
					
				</div>
				
			</div>
			
		</div>
		
	</div>
</div>

<!-- 품목그룹추가 팝업 -->
<div id="add-product-group-popup" style="position: absolute; left: 0px; top: 0px; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: none; z-index: 4;">

	<div id="add_product_group_popup_content" style="position: absolute; background-color: white; border-radius: 4px; left: calc( 50% - 200px ); top: calc( 50% - 88px ); width: 400px; padding: 20px;">
		<div class="col-md-12 smc-header" style="border-bottom: #ccc solid 2px;">
			품목그룹 추가
		</div>
		<div class="popup-row">
			<div class="col-md-4" style="text-align: right; font-size: 12px; font-weight: bold; padding-top: 3px;">
				<span style="color: #ff0000;">*</span>품목그룹명
			</div>
			<div class="col-md-8">
				<input id="add-product-group-name-inp" class="smc-inp" type="text" placeholder="품목그룹명을 입력해주세요.">
			</div>
		</div>
		<div class="popup-row mt20">
			<div class="col-md-12">
				<div class="smc-btn-wrap">
					<div id="add-product-group-complete-btn" class="smc-btn blue">완료</div>
					<div id="add-product-group-cancel-btn" class="smc-btn">취소</div>
				</div>
			</div>
		</div>
	</div>

</div>
<!-- 품목추가 팝업 -->
<div id="add-product-popup" style="position: absolute; left: 0px; top: 0px; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: none; z-index: 4;">

	<div id="add_product_popup_content" style="position: absolute; background-color: white; border-radius: 4px; left: calc( 50% - 200px ); top: calc( 50% - 88px ); width: 400px; padding: 20px;">
		<div class="col-md-12 smc-header" style="border-bottom: #ccc solid 2px;">
			품목 추가
		</div>
		<div class="popup-row">
			<div class="col-md-4" style="text-align: right; font-size: 12px; font-weight: bold; padding-top: 3px;">
				<span style="color: #ff0000;">*</span>품목명
			</div>
			<div class="col-md-8">
				<input id="add-product-name-inp" class="smc-inp" type="text" placeholder="품목명을 입력해주세요.">
			</div>
		</div>
		<div class="popup-row mt20">
			<div class="col-md-12">
				<div class="smc-btn-wrap">
					<div id="add-product-complete-btn" class="smc-btn blue">완료</div>
					<div id="add-product-cancel-btn" class="smc-btn">취소</div>
				</div>
			</div>
		</div>
	</div>

</div>

<!-- 품목그룹수정 팝업 -->
<div id="product-group-mod-popup" class="smc-popup" style="position: absolute; left: 0px; top: 0px; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: none; z-index: 9999;">

	<div id="product-group-mod_popup_content" style="position: absolute; background-color: white; border-radius: 4px; left: calc( 50% - 200px ); top: calc( 50% - 88px ); width: 400px; padding: 20px;">
		<div class="col-md-12 smc-header" style="border-bottom: #ccc solid 2px;">
			품목그룹 수정
		</div>
		<div class="popup-row">
			<div class="col-md-4" style="text-align: right; font-size: 12px; font-weight: bold; padding-top: 3px;">
				<span style="color: #ff0000;">*</span>품목그룹명
			</div>
			<div class="col-md-8">
				<input id="product-group-mod-name-inp" class="smc-inp" type="text" placeholder="품목그룹명을 입력해주세요.">
			</div>
		</div>
		<div class="popup-row mt10">
			<div class="col-md-4" style="text-align: right; font-size: 12px; font-weight: bold; padding-top: 3px;">
				<span style="color: #ff0000;">*</span>사용여부
			</div>
			<div class="col-md-8">
				<div id="product-group-mod-use-btn" class="smc-btn" style="float: left;">사용</div>
				<div id="product-group-mod-unuse-btn" class="smc-btn"  style="float: left;">미사용</div>
			</div>
		</div>
		<div class="popup-row mt6">
			<div class="col-md-offset-4 col-md-8" style="font-size: 10px; color: #616161;">
				&nbsp; ※미사용은 정산을 수행할 수 없습니다.
			</div>
		</div>
		<div class="popup-row mt20">
			<div class="col-md-12">
				<div class="smc-btn-wrap">
					<div id="product-group-mod-complete-btn" class="smc-btn blue">완료</div>
					<div id="product-group-mod-cancel-btn" class="smc-btn">취소</div>
				</div>
			</div>
		</div>
	</div>

</div>

<!-- 품목수정 팝업 -->
<div id="product-mod-popup" class="smc-popup" style="position: absolute; left: 0px; top: 0px; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: none; z-index: 9999;">

	<div id="product-mod_popup_content" style="position: absolute; background-color: white; border-radius: 4px; left: calc( 50% - 200px ); top: calc( 50% - 88px ); width: 400px; padding: 20px;">
		<div class="col-md-12 smc-header" style="border-bottom: #ccc solid 2px;">
			품목 수정
		</div>
		<div class="popup-row mt10">
			<div class="col-md-4" style="text-align: right; font-size: 12px; font-weight: bold; padding-top: 3px;">
				<span style="color: #ff0000;">*</span>품목명
			</div>
			<div class="col-md-8">
				<input id="product-mod-name-inp" class="smc-inp" type="text" placeholder="품목명을 입력해주세요.">
			</div>
		</div>
		<div class="popup-row mt10">
			<div class="col-md-4" style="text-align: right; font-size: 12px; font-weight: bold; padding-top: 3px;">
				<span style="color: #ff0000;">*</span>사용여부
			</div>
			<div class="col-md-8">
				<div id="product-mod-use-btn" class="smc-btn" style="float: left;">사용</div>
				<div id="product-mod-unuse-btn" class="smc-btn"  style="float: left;">미사용</div>
			</div>
		</div>
		<div class="popup-row mt6">
			<div class="col-md-offset-4 col-md-8" style="font-size: 10px; color: #616161;">
				&nbsp; ※미사용은 정산을 수행할 수 없습니다.
			</div>
		</div>
		<div class="popup-row mt20">
			<div class="col-md-12">
				<div class="smc-btn-wrap">
					<div id="product-mod-complete-btn" class="smc-btn blue">완료</div>
					<div id="product-mod-cancel-btn" class="smc-btn">취소</div>
				</div>
			</div>
		</div>
	</div>

</div>

<!-- 품목으로 가져오기 팝업 -->
<div id="product-import-popup" class="smc-popup" style="position: absolute; left: 0px; top: 0px; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: none; z-index: 9999;">

	<div id="product-import_popup_content" style="position: absolute; background-color: white; border-radius: 4px; left: calc( 50% - 200px ); top: calc( 50% - 88px ); width: 400px; padding: 20px;">
		<div class="col-md-12 smc-header" style="border-bottom: #ccc solid 2px;">
			품목으로 가져오기
		</div>
		<div class="popup-row mt10">
			<div class="col-md-6" style="text-align: right; font-size: 12px; font-weight: bold; padding-top: 3px;">
				<span style="color: #ff0000;">*</span>가져올 수 있는 품목그룹
			</div>
			<div class="col-md-6">
				<select id="product-import-group-sel" class="smc-select">
					<option value="NO_SELECT">선택</option>
				</select>
			</div>
		</div>
		<div class="popup-row mt20">
			<div class="col-md-12">
				<div class="smc-btn-wrap">
					<div id="product-import-complete-btn" class="smc-btn blue">완료</div>
					<div id="product-import-cancel-btn" class="smc-btn">취소</div>
				</div>
			</div>
		</div>
	</div>

</div>

<script type="text/javascript">

/**
	jquery 변수
**/

var $window = $(window); // 윈도우
var $body = $("body"); // 바디

// 컬럼
var $productColumnList = $("#product-column-list"); // 컬럼 목록
 
// 상단 버튼 부분
var $addProductGroupBtn = $("#add-product-group-btn"); // 품목그룹 추가 버튼
var $delProductGroupBtn = $("#del-product-group-btn"); // 품목그룹 삭제 버튼
var $productGroupModBtn = $("#mod-product-group-btn"); // 수정 버튼

var $addProductBtn = $("#add-product-btn"); // 품목 추가 버튼
var $delProductBtn = $("#del-product-btn"); // 품목그룹 삭제 버튼
var $productModBtn = $("#mod-product-btn"); // 수정 버튼
var $importProductBtn = $("#import-product-btn"); // 품목으로가져오기 버튼
var $exportProductBtn = $("#export-product-btn"); // 품목그룹으로내보내기 버튼

var $saveBtn = $("#save-btn"); // 저장 버튼

// 품목그룹 추가 팝업 부분
var $addProductGroupPopup = $("#add-product-group-popup"); // 품목그룹 추가 팝업 ( 배경포함 )
var $addProductGroupPopupContent = $("#add_product_group_popup_content"); // 품목그룹 추가 팝업 ( 내용 )
var $addProductGroupCancelBtn = $("#add-product-group-cancel-btn"); // 품목그룹 추가 팝업 - 취소 버튼
var $addProductGroupCompleteBtn = $("#add-product-group-complete-btn"); // 품목그룹 추가 팝업 - 완료 버튼
var $addProductGroupNameInp = $("#add-product-group-name-inp"); // 품목그룹 추가 팝업 - 품목그룹명 입력창

// 품목그룹 수정 수정 팝업 부분
var $productGroupModPopup = $("#product-group-mod-popup"); // 수정 팝업 ( 배경 포함 )
var $productGroupModPopupContent = $("#product-group-mod_popup_content"); // 수정 팝업 ( 내용 )
var $productGroupModCancelBtn = $("#product-group-mod-cancel-btn"); // 취소 버튼
var $productGroupModCompleteBtn = $("#product-group-mod-complete-btn"); // 완료 버튼
var $productGroupModNameInp = $("#product-group-mod-name-inp"); // 수정 팝업 - 소속명 입력창
var $productGroupModUseBtn = $("#product-group-mod-use-btn"); // 사용 버튼
var $productGroupModUnuseBtn = $("#product-group-mod-unuse-btn"); // 사용 버튼

// 품목그룹 추가 팝업 부분
var $addProductPopup = $("#add-product-popup"); // 품목그룹 추가 팝업 ( 배경포함 )
var $addProductPopupContent = $("#add_product_popup_content"); // 품목그룹 추가 팝업 ( 내용 )
var $addProductCancelBtn = $("#add-product-cancel-btn"); // 품목그룹 추가 팝업 - 취소 버튼
var $addProductCompleteBtn = $("#add-product-complete-btn"); // 품목그룹 추가 팝업 - 완료 버튼
var $addProductNameInp = $("#add-product-name-inp"); // 품목그룹 추가 팝업 - 품목그룹명 입력창

// 품목그룹 수정 수정 팝업 부분
var $productModPopup = $("#product-mod-popup"); // 수정 팝업 ( 배경 포함 )
var $productModPopupContent = $("#product-mod_popup_content"); // 수정 팝업 ( 내용 )
var $productModCancelBtn = $("#product-mod-cancel-btn"); // 취소 버튼
var $productModCompleteBtn = $("#product-mod-complete-btn"); // 완료 버튼
var $productModNameInp = $("#product-mod-name-inp"); // 수정 팝업 - 소속명 입력창
var $productModUseBtn = $("#product-mod-use-btn"); // 사용 버튼
var $productModUnuseBtn = $("#product-mod-unuse-btn"); // 사용 버튼

// 품목그룹 가져오기 팝업 부분
var $productImportPopup = $("#product-import-popup"); // 수정 팝업 ( 배경 포함 )
var $productImportPopupContent = $("#product-import_popup_content"); // 수정 팝업 ( 내용 )
var $productImportCancelBtn = $("#product-import-cancel-btn"); // 취소 버튼
var $productImportCompleteBtn = $("#product-import-complete-btn"); // 완료 버튼
var $productImportGroupSel = $("#product-import-group-sel"); // 품목그룹 선택창

// 그룹 목록 부분
var $productGroupList = $("#product-group-list"); // 품목그룹 목록
var $productList = $("#product-list"); // 품목 목록
var $productGroupCntSpan = (function(){
	
	var $this = $("#product-group-cnt-span"); // 그룹수
	$this.update = function(){
		var cnt = $productGroupList.find(".product-group-item").filter(":visible").length;
		$this.text( cnt );
		return $this;
	};
	return $this;
	
})();
var $productCntSpan = (function(){
	
	var $this = $("#product-cnt-span"); // 그룹수
	$this.update = function(){
		var cnt = $productList.find(".product-group-item").filter(":visible").length;
		$this.text( cnt );
		return $this;
	};
	return $this;
	
})();

function updateProductGroupItemsOrder(){
	
	var $options = $productImportGroupSel.find("option");
	var $items = $productGroupList.find(".product-group-item");
	for( var i=0; i<$items.length; ++i ){
		var $item = $items.eq( i );
		$item.updateProductOrder();
		var order = $item.getOrder();
		var id = $item.getId();
		var $option = $options.filter( "[value='"+id+"']" );
		$option.data( "order", order );
	}
	
	// 품목그룹 선택창 순서 변경
	var arr = [];
	for( var i=1; i<$options.length; ++i ){
		var $option = $options.eq( i ).detach();
		var order = $option.data("order");
		arr[ order ] = $option;
	}
	
	arr.forEach(function( $option ){
		$option.appendTo( $productImportGroupSel );
	});
	
}

function updateProductItemsOrder(){
	
	var $items = $productList.find(".product-group-item");
	for( var i=0; i<$items.length; ++i ){
		var $item = $items.eq( i );
		$item.updateProductOrder();
	}
	
}
 
/**
	모듈
 **/
 
 var TimeModule = {
		
		now: function(){
			var now = new Date();
			var yyyy = now.getFullYear().toString();
			var MM = ( now.getMonth() + 1 ).toString().padStart( 2, 0 );
			var dd = now.getDate().toString().padStart( 2, 0 );
			var hh = now.getHours().toString().padStart( 2, 0 );
			var mm = now.getMinutes().toString().padStart( 2, 0 );
			var ss = now.getSeconds().toString().padStart( 2, 0 );
			return {
				object: now,
				yyyy: yyyy,
				MM: MM,
				dd: dd,
				hh: hh,
				mm: mm,
				ss: ss
			}
		}
		
};
 
 // jQuery 템플릿 모듈
var $TemplateModule = (function(){
 
	var template = {
	
		"product-group-item": [
			'<div class="product-group-item">',
				'<div class="product-group-order">',
				'</div>',
				'<div class="product-group-name">',
				'</div>',
				'<div class="product-group-use">',
				'</div>',
				'<div class="product-group-regdate">',
				'</div>',
				'<div class="product-group-update">',
				'</div>',
			'</div>'
		].join(""),
		
		"product-column-parent": [
			'<div class="product-column-parent">',
				'<div class="product-column-name product-column-parent-name">5G/L</div>',
			'</div>'
		].join(""),
		
		"product-column-children": [
			'<div class="product-column-children">',
				'<div class="product-column-name">Box</div>',
			'</div>'
		].join(""),
		
		"option": '<option value="NO_SELECT">선택</option>'
	 
	};

	return {
	
		template: template,
		
		createOption: function( id, name ){
			var $option = $( template[ "option" ] );
			$option.val( id );
			$option.text( name );
			return $option;
		},
		
		// jQuery 신규 제품그룹 객체 생성
		createProduct: (function(){
		
			// 현재 UI 순서로 갱신
			$.fn.updateProductOrder = function updateProductOrder(){
				
				var $productGroupItems = this.parent().find(".product-group-item");
				var gridIndex = $productGroupItems.index( this );
				this.data( "order", gridIndex );
				
				var $column = this.data( "$column" );
				var use = this.data( use );
				if( use ){
					var $usedProductGroupItems = $productGroupItems.not(".unuse");
					var columnIndex = $usedProductGroupItems.index( this );
					this.find(".product-group-order").text( columnIndex + 1 );
					var $columns = $column.parent().children();
					$column.insertAfter( $columns.eq( columnIndex ) );
				}else{
					this.find(".product-group-order").text( "-" );
					$column.detach();
				}
				
				
			};
			
			$.fn.getOrder = function getOrder(){
				return this.data( "order" );
			};
		
			// 부모아이디 조회
			$.fn.getParentId = function getParentId(){
				return this.data("parentId");
			};
			
			// 아이디 설정
			$.fn.setId = function setId( id ){
				this.data("id", id);
			};
			$.fn.getId = function getId(){
				return this.data("id");
			};
			
			// 이름 설정
			$.fn.setParentId = function setParentId( parentId ){
				this.data("parentId", parentId);
			};
		
			// 이름 조회
			$.fn.getName = function getName(){
				return this.data("name");
			};
			
			// 이름 설정
			$.fn.setName = function setName( name ){
				this.data("name", name);
				this.find(".product-group-name").text(name);
				this.data("$column").children(".product-column-name").text( name );
			};
			
			// 이름 설정
			$.fn.setRemove = function setRemove( remove ){
				this.data("remove", remove);
				if( remove == true ){
					this.hide();
				}else{
					this.show();
				}
			};
			
			// 사용여부 조회
			$.fn.getUse = function(){
				return this.data("use"); 
			};
		
			// 삭제가능 여부
			$.fn.setEnableDelete = function( enableDelete ){
				this.data("enableDelete", enableDelete);
				if( enableDelete == false ){
					this.addClass("disable");
				}
			};
		
			// 사용여부 설정
			$.fn.setUse = function( bool ){
				this.data("use", bool);
				if( bool == true ){
					this.find(".product-group-use").text("사용");
					this.removeClass("unuse");
					this.data("$column").show();
				}else{
					this.find(".product-group-use").text("미사용");
					this.addClass("unuse");
					this.data("$column").hide();
				}
			};
		
			// 수정일 갱신
			$.fn.updateDate = function updateDate(){
				var now = TimeModule.now();
				this.data( "updateDate", now.yyyy + now.MM + now.dd + now.hh + now.mm + now.ss );
				this.find( ".product-group-update" ).text( now.yyyy + "-" + now.MM  + "-" + now.dd );
			};
			
			// 저장용 데이터
			$.fn.getSaveData = function getSaveData(){
				
				var data = JSON.parse( JSON.stringify( this.data() ) );
				delete data.$column;
				return data; 
			
			};
		
			return function( parentId, id, name, use, enableDelete, createDate, updateDate ){
		 
				var $clone = $( template[ "product-group-item" ] );
				
				var columnTemplateName = "product-column-parent";
				var $columnParent = $productColumnList;
				
				if( parentId != "TOP" ){
					columnTemplateName = "product-column-children";
					$columnParent = ProductModule.map[ parentId ].data( "$column" );
					$columnParent.addClass( "has-children" );
				}
				var $column = $( template[ columnTemplateName ] );
				$column.appendTo( $columnParent );
				$clone.data({
					parentId: null,
					id: null,
					name: null,
					use: null,
					enableDelete: null,
					createDate: null,					
					updateDate: null,
					$column: $column,
				});
				
				// 품목그룹 아이디
				$clone.setParentId( parentId );
				
				// 아이디
				if( id == null ){
					id = "PRG::" + ( Date.now() + Math.random() ).toString().replace(".", "");
				}
				$clone.setId( id );
				
				// 소속명 ( 필수값 )
				$clone.setName( name );
				
				// 사용여부
				if( use == null ){
					use = true;
				}
				$clone.setUse( use );
				
				if( enableDelete == null ){
					enableDelete = true;
				}
				$clone.setEnableDelete( enableDelete );
				
				// 등록일
				if( createDate == null ){
					var now = TimeModule.now();
					$clone.data( "createDate", now.yyyy + now.MM + now.dd + now.hh + now.mm + now.ss );
					$clone.find( ".product-group-regdate" ).text( now.yyyy + "-" + now.MM  + "-" + now.dd );
				}else{
					var yyyy = createDate.slice( 0, 4 );
					var MM = createDate.slice( 4, 6 );
					var dd = createDate.slice( 6, 8 );
					var hh = createDate.slice( 8, 10 );
					var mm = createDate.slice( 10, 12 );
					var ss = createDate.slice( 12, 14 );
					$clone.data( "createDate", yyyy + MM + dd + hh + mm + ss );
					$clone.find( ".product-group-regdate" ).text( yyyy + "-" + MM  + "-" + dd );
				}
				
				// 수정일
				if( updateDate == null ){
					$clone.updateDate();
				}else{
					var yyyy = updateDate.slice( 0, 4 );
					var MM = updateDate.slice( 4, 6 );
					var dd = updateDate.slice( 6, 8 );
					var hh = updateDate.slice( 8, 10 );
					var mm = updateDate.slice( 10, 12 );
					var ss = updateDate.slice( 12, 14 );
					$clone.data( "updateDate", yyyy + MM + dd + hh + mm + ss );
					$clone.find( ".product-group-update" ).text( yyyy + "-" + MM  + "-" + dd );
				}
				
				return $clone;
				 
			}
		 
		})()
	
	};

})();
 
 
/****************************************
	데이터 로드
****************************************/
var ProductModule = {
		
		map: {
			// id: $item
		},
		parentChildrenMap: {
			// parentId: [ $item... ]
		},
		add: function( $item ){
			
			var parentId = $item.getParentId();
			if( ProductModule.parentChildrenMap[ parentId ] == null ){
				ProductModule.parentChildrenMap[ parentId ] = [];
			}
			ProductModule.parentChildrenMap[ parentId ].push( $item );
			
			var id = $item.getId();
			if( ProductModule.parentChildrenMap[ id ] == null ){
				ProductModule.parentChildrenMap[ id ] = [];
			}
			ProductModule.map[ id ] = $item;
			
		},
		remove: function( $item ){
			
			var id = $item.getId(); 
			var parentId = $item.getParentId();
			var $childrens = ProductModule.parentChildrenMap[ parentId ];
			for( var i=0; i<$childrens.length; ++i ){
				var $children = $childrens[ i ];
				if( $children.getId() == id  ){
					$childrens.splice( i, 1 );
					break;
				}
			}
			
			var $myChildrens = ProductModule.parentChildrenMap[ id ];
			if( $myChildrens != null ){
				delete ProductModule.parentChildrenMap[ id ];
			}
			
			delete ProductModule.map[ id ];
			
		}
		
};
var products = <%- products %>;
products.sort(function( a, b ){
	
	if( a.order < b.order ){
		return -1;
	}
	
	if( a.order > b.order ){
		return 1;
	}
	
	return 0;
	
});
// 품목그룹 먼저 추가
for( var i=0; i<products.length; ++i ){
	var product = products[ i ];
	if( product.parentId != "TOP" ){
		continue;
	}
	var $productGroup = $TemplateModule.createProduct( product.parentId, product.id, product.name, product.use, product.enableDelete, product.createDate, product.updateDate );
	$productGroup.appendTo( $productGroupList );
	ProductModule.add( $productGroup );
	
	var $option = $TemplateModule.createOption( product.id, product.name );
	$option.appendTo( $productImportGroupSel );
	
}
// 품목 추가
for( var i=0; i<products.length; ++i ){
	var product = products[ i ];
	if( product.parentId == "TOP" ){
		continue;
	}
	var $productGroup = $TemplateModule.createProduct( product.parentId, product.id, product.name, product.use, product.enableDelete, product.createDate, product.updateDate );
	ProductModule.add( $productGroup );
	
}
updateProductGroupItemsOrder();

//수량 표시 갱신
$productGroupCntSpan.update();

 
/****************************************
	이벤트
****************************************/

// 품목그룹 추가 버튼 클릭 이벤트
$addProductGroupBtn.on("click", function(){
	
	// 팝업 그룹명 제거
	$addProductGroupNameInp.val("");
	
	// 팝업 표시
	$addProductGroupPopup.fadeIn( 500 );
	parent.hideNav( 500 );
	$addProductGroupNameInp.focus();
	$addProductGroupPopupContent.css( { "margin-top": "-40px" } ).animate( { "margin-top": "0px" }, 500 );
	
});

// 품목 추가 버튼 클릭 이벤트
$addProductBtn.on("click", function(){
	
	// 팝업명 제거
	$addProductNameInp.val("");
	
	// 팝업 표시
	$addProductPopup.fadeIn( 500 );
	parent.hideNav( 500 );
	$addProductNameInp.focus();
	$addProductPopupContent.css( { "margin-top": "-40px" } ).animate( { "margin-top": "0px" }, 500 );
	
});

// 품목그룹 추가팝업 - 취소 버튼 클릭 이벤트
$addProductGroupCancelBtn.on("click", function(){
	
	// 팝업 제거
	parent.showNav( 500 );
	$addProductGroupPopup.fadeOut( 500 );
	$addProductGroupPopupContent.css( { "margin-top": "0px" } ).animate( { "margin-top": "-40px" }, 500 );
	
});
// 품목 추가팝업 - 취소 버튼 클릭 이벤트
$addProductCancelBtn.on("click", function(){
	
	// 팝업 제거
	parent.showNav( 500 );
	$addProductPopup.fadeOut( 500 );
	$addProductPopupContent.css( { "margin-top": "0px" } ).animate( { "margin-top": "-40px" }, 500 );
	
});

// 품목그룹 추가팝업 - 완료 버튼 클릭 이벤트
$addProductGroupCompleteBtn.on("click", function(){
	
	var newGroupName = $addProductGroupNameInp.val().trim();
	if( newGroupName == "" ){
		alert( "품목그룹명이 비어있습니다." );
		return;
	}
	
	var $groupItems = $productGroupList.find( ".product-group-item" );
	for( var i=0; i<$groupItems.length; ++i ){
		var groupName =  $groupItems.eq( i ).getName();
		if( newGroupName == groupName ){
			alert( "이미 존재하는 품목그룹명 입니다." );
			return;
		}
	}
	
	var $groupItem = $TemplateModule.createProduct( "TOP", null, newGroupName );
	ProductModule.add( $groupItem );
	
	var $option = $TemplateModule.createOption( $groupItem.getId(), newGroupName );
	$option.appendTo( $productImportGroupSel );
	
	// 팝업 제거
	parent.showNav( 500 );
	$addProductGroupPopup.fadeOut( 500 );
	$addProductGroupPopupContent.css( { "margin-top": "0px" } );
	$addProductGroupPopupContent.animate( { "margin-top": "-40px" }, 500, function(){
		
		// 넓어지는 애니메이션으로 표시
		$groupItem.css( { "height": "0px" } );
		$groupItem.appendTo( $productGroupList );
		updateProductGroupItemsOrder();
		
		$groupItem.animate( { "height": "37px" }, 500 );
		
		// 수량 표시 갱신
		$productGroupCntSpan.update();
		
	} );
	
});

// 품목 추가팝업 - 완료 버튼 클릭 이벤트
$addProductCompleteBtn.on("click", function(){
	
	var newGroupName = $addProductNameInp.val().trim();
	if( newGroupName == "" ){
		alert( "품목명이 비어있습니다." );
		return;
	}
	
	var $groupItems = $productList.find( ".product-group-item" );
	for( var i=0; i<$groupItems.length; ++i ){
		var groupName =  $groupItems.eq( i ).getName();
		if( newGroupName == groupName ){
			alert( "이미 존재하는 품목명 입니다." );
			return;
		}
	}
	
	var $selectedGroupItem = $productGroupList.find(".product-group-item.select");
	var parentId = $selectedGroupItem.getId();
	var $groupItem = $TemplateModule.createProduct( parentId, null, newGroupName );
	ProductModule.add( $groupItem );
	
	// 팝업 제거
	parent.showNav( 500 );
	$addProductPopup.fadeOut( 500 );
	$addProductPopupContent.css( { "margin-top": "0px" } );
	$addProductPopupContent.animate( { "margin-top": "-40px" }, 500, function(){
		
		// 넓어지는 애니메이션으로 표시
		$groupItem.css( { "height": "0px" } );
		$groupItem.appendTo( $productList );
		updateProductItemsOrder();
		
		$groupItem.animate( { "height": "37px" }, 500 );
		
		// 수량 표시 갱신
		$productCntSpan.update();
		
	} );
	
});

// 그룹명 입력 이벤트
$addProductGroupNameInp.on("keypress", function( e ){
	
	// 엔터키 == 완료버튼 클릭
	if( e.keyCode == 13 ){
		
		$addProductGroupCompleteBtn.trigger("click");
		
	}
	
});
// 그룹명 입력 이벤트
$addProductNameInp.on("keypress", function( e ){
	
	// 엔터키 == 완료버튼 클릭
	if( e.keyCode == 13 ){
		
		$addProductCompleteBtn.trigger("click");
		
	}
	
});

// 품목그룹순서 변경
(function(){
	
	var $select = null;
	var isMousedown = false;
	
	// 그룹아이템 마우스다운 이벤트
	$productGroupList.on("mousedown", ".product-group-item", function(){
		
		isMousedown = true;
		
		// 기존 선택 제거
		var $this = $(this);
		$productGroupList.find(".product-group-item").not( $this ).removeClass( "select" );
		$productList.find(".product-group-item").removeClass( "select" );
		
		// 기존 자식 목록 제거
		var $beforeProductItems = $productList.find(".product-group-item");
		for( var i=0; i<$beforeProductItems.length; ++i ){
			var $productItem = $beforeProductItems.eq( i );
			$productItem.detach();
		}
		
		var parentId = $this.getId();
		console.log( parentId );
		var $productItems = ProductModule.parentChildrenMap[ parentId ];
		$productItems.sort(function( a, b ){
			
			var aOrder = a.data("order");
			var bOrder = b.data("order");
			if( aOrder < bOrder ){
				return -1;
			}
			
			if( aOrder > bOrder ){
				return 1;
			}
			
			return 0;
			
		});
		$productItems.forEach(function( $productItem ){
			console.log( $productItem );
			$productItem.appendTo( $productList );
		});
		$productCntSpan.update();
		updateProductItemsOrder();
		
		$this.addClass("select");
		$importProductBtn.removeClass( "disable" );
		$delProductGroupBtn.removeClass( "disable" );
		$productGroupModBtn.removeClass( "disable" );
		$addProductBtn.removeClass( "disable" );
		$exportProductBtn.addClass( "disable" );
		$productModBtn.addClass( "disable" );
		$delProductBtn.addClass( "disable" );
		$select = $this;
		
		
	});
	
	$productGroupList.on("mousemove", ".product-group-item", function(){
		
		if( isMousedown == false ){
			return;
		}
		
		if( $select == null ){
			return;
		}
		
		$select.css( { cursor: "move" } );
		
	});
	
	$productGroupList.on("mouseenter", ".product-group-item", function(){
		
		if( isMousedown == false ){
			return;
		}
		
		if( $select == null ){
			return;
		}
		
		var $this = $(this);
		if( $select.get(0) == $this.get(0) ){
			return;
		}

		var mouseenterIdx = $productGroupList.find( ".product-group-item" ).index( $this );
		var moveIdx = $productGroupList.find( ".product-group-item" ).index( $select );
		
		if( moveIdx > mouseenterIdx ){
			$this.before( $select );
		}else{
			$this.after( $select );
		}
		
		updateProductGroupItemsOrder();
		
	});
	
	$productGroupList.on("mouseup", ".product-group-item", function( e ){
		
		// 기존 선택 제거
		var $select = $productGroupList.find(".product-group-item.select");
		$select.css( { cursor: "pointer" } );
		isMousedown = false;
		
	});
	
})();
// 품목순서 변경
(function(){
	
	var $select = null;
	var isMousedown = false;
	
	// 그룹아이템 마우스다운 이벤트
	$productList.on("mousedown", ".product-group-item", function(){
		
		isMousedown = true;
		
		// 기존 선택 제거
		var $this = $(this);
		$productList.find(".product-group-item").not( $this ).removeClass( "select" );
		
		$this.addClass("select");
		$exportProductBtn.removeClass( "disable" );
		$productModBtn.removeClass( "disable" );
		$delProductBtn.removeClass( "disable" );
		$select = $this;
		
		
	});
	
	$productList.on("mousemove", ".product-group-item", function(){
		
		if( isMousedown == false ){
			return;
		}
		
		if( $select == null ){
			return;
		}
		
		$select.css( { cursor: "move" } );
		
	});
	
	$productList.on("mouseenter", ".product-group-item", function(){
		
		if( isMousedown == false ){
			return;
		}
		
		if( $select == null ){
			return;
		}
		
		var $this = $(this);
		if( $select.get(0) == $this.get(0) ){
			return;
		}

		var mouseenterIdx = $productList.find( ".product-group-item" ).index( $this );
		var moveIdx = $productList.find( ".product-group-item" ).index( $select );
		
		if( moveIdx > mouseenterIdx ){
			$this.before( $select );
		}else{
			$this.after( $select );
		}
		
		updateProductItemsOrder();
		
	});
	
	$productList.on("mouseup", ".product-group-item", function( e ){
		
		// 기존 선택 제거
		var $select = $productList.find(".product-group-item.select");
		$select.css( { cursor: "pointer" } );
		isMousedown = false;
		
	});
	
})();

// 품목그룹 삭제 버튼 클릭 이벤트
$delProductGroupBtn.on("click", function(){
	
	// 활성화된 경우만 기능 동작
	if( $delProductGroupBtn.hasClass("disable") ){
		return;
	}
	
	var $selectedGroupItem = $productGroupList.find(".product-group-item.select");
	var groupName = $selectedGroupItem.getName();
	if( confirm( "'" + groupName + "'을 삭제하시겠습니까?\n하위에 포함된 '품목'은 모두 '품목그룹'으로 변경됩니다." ) ){
		
		var $childrens = ProductModule.parentChildrenMap[ $selectedGroupItem.getId() ];
		var $parents = ProductModule.parentChildrenMap[ "TOP" ];
		for( var i=0; i<$childrens.length; ++i ){
			var $children = $childrens[ i ];
			var childrenName = $children.getName();
			for( var j=0; j<$parents.length; ++j ){
				var $parent = $parents[ j ];
				var parentName = $parent.getName();
				if( childrenName == parentName ){
					alert( "품목그룹에 이미 \"" + childrenName + "\"이(가) 있습니다." );
					return;
				}
			}
		}
		
		// 삭제모션
		$selectedGroupItem.animate( { "height": "0px" }, 500, function(){
			
			// 하위 폼목을 품목그룹으로 변경
			ProductModule.parentChildrenMap[ "TOP" ] = $parents.concat( $childrens );
			$childrens.forEach(function( $children ){
				// 그리드 변경
				$children.appendTo( $productGroupList );
				
				// 신규 컬럼생성하여 추가
				var $newColumn = $( $TemplateModule.template[ "product-column-parent" ] );
				$newColumn.find(".product-column-name").text( $children.getName() );
				$newColumn.appendTo( $productColumnList );
				$children.data( "$column", $newColumn );
				$children.setParentId( "TOP" );
			});
			
			// 컬럼 삭제
			var $column = $selectedGroupItem.data( "$column" );
			$column.remove();
			
			// 맵핑 삭제
			ProductModule.remove( $selectedGroupItem );
			$selectedGroupItem.hide();
			$selectedGroupItem.setRemove( true );  
			$selectedGroupItem.updateDate();  
			$selectedGroupItem.removeClass( "select" );
			
			// 수량 표시 갱신
			$productGroupCntSpan.update();
			
			// 버튼 비활성화
			$delProductGroupBtn.addClass( "disable" );
			$productGroupModBtn.addClass( "disable" );
			$exportProductBtn.addClass( "disable" );
			$productModBtn.addClass( "disable" );
			$delProductBtn.addClass( "disable" );
			updateProductGroupItemsOrder();
			
		} );
		
		
	}
	
});

// 품목 삭제 버튼 클릭 이벤트
$delProductBtn.on("click", function(){
	
	// 활성화된 경우만 기능 동작
	if( $delProductBtn.hasClass("disable") ){
		return;
	}
	
	var $selectedItem = $productList.find(".product-group-item.select");
	var productName = $selectedItem.getName();
	if( confirm( "'" + productName + "'을 삭제하시겠습니까?" ) ){
		
		// 삭제모션
		$selectedItem.animate( { "height": "0px" }, 500, function(){
			
			// 컬럼 삭제
			var $column = $selectedItem.data( "$column" );
			$column.remove();
			
			// 맵퍼 삭제
			ProductModule.remove( $selectedItem );
			$selectedItem.hide();
			$selectedItem.setRemove( true );
			$selectedItem.updateDate();
			$selectedItem.removeClass( "select" );
			
			// 수량 표시 갱신
			$productCntSpan.update();
			
			// 버튼 비활성화
			$exportProductBtn.addClass( "disable" );
			$productModBtn.addClass( "disable" );
			$delProductBtn.addClass( "disable" );
			updateProductItemsOrder();
			
			// 부모의 자식이 없는 경우, 컬럼 병합형태로 변경
			var $selectedGroupItem = $productGroupList.find(".product-group-item.select");
			var $parentColumn = $selectedGroupItem.data( "$column" );
			var hasChildren = 0 < $parentColumn.find( ".product-column-children" ).length;
			if( hasChildren == false ){
				$parentColumn.removeClass( "has-children" );
			}
			
		} );
		
		
	}
	
});

// 품목그룹 수정 버튼 클릭 이벤트
$productGroupModBtn.on("click", function(){
	
	// 활성화된 경우만 기능 동작
	if( $delProductGroupBtn.hasClass("disable") ){
		return;
	}
	
	// 선택된 소속
	var $selectedGroupItem = $productGroupList.find(".product-group-item.select");
	var groupName = $selectedGroupItem.getName();
	
	// 이름 설정
	$productGroupModNameInp.val( groupName );
	
	// 사용여부 설정
	var use = $selectedGroupItem.getUse();
	if( use ){
		$productGroupModUseBtn.addClass("select");
		$productGroupModUnuseBtn.removeClass("select");
	}else{
		$productGroupModUnuseBtn.addClass("select");
		$productGroupModUseBtn.removeClass("select");
	}
	
	// 팝업 표시
	$productGroupModPopup.fadeIn( 500 );
	parent.hideNav( 500 );
	$productGroupModPopupContent.css( { "margin-top": "-40px" } ).animate( { "margin-top": "0px" }, 500 );
	
	// 입력창 포커스 ( show 이후에 처리 필요 )
	$productGroupModNameInp.focus();
	
});

// 품목수정 버튼 클릭 이벤트
$productModBtn.on("click", function(){
	
	// 활성화된 경우만 기능 동작
	if( $delProductBtn.hasClass("disable") ){
		return;
	}
	
	// 선택된 소속
	var $selectedItem = $productList.find(".product-group-item.select");
	var name = $selectedItem.getName();
	var parentId = $selectedItem.getParentId();
	
	// 이름 설정
	$productModNameInp.val( name );
	
	// 사용여부 설정
	var use = $selectedItem.getUse();
	if( use ){
		$productModUseBtn.addClass("select");
		$productModUnuseBtn.removeClass("select");
	}else{
		$productModUnuseBtn.addClass("select");
		$productModUseBtn.removeClass("select");
	}
	
	// 팝업 표시
	$productModPopup.fadeIn( 500 );
	parent.hideNav( 500 );
	$productModPopupContent.css( { "margin-top": "-40px" } ).animate( { "margin-top": "0px" }, 500 );
	
	// 입력창 포커스 ( show 이후에 처리 필요 )
	$productModNameInp.focus();
	
});

// 품목그룹 수정팝업 - 사용 버튼 클릭 이벤트
$productGroupModUseBtn.on("click", function(){
	
	$productGroupModUseBtn.addClass("select");
	$productGroupModUnuseBtn.removeClass("select");
	
});

// 품목그룹 수정팝업 - 미사용 버튼 클릭 이벤트
$productGroupModUnuseBtn.on("click", function(){
	
	$productGroupModUnuseBtn.addClass("select");
	$productGroupModUseBtn.removeClass("select");
	
	
});

// 품목그룹 수정팝업 - 취소 버튼 클릭 이벤트
$productGroupModCancelBtn.on("click", function(){
	
	// 팝업 제거
	parent.showNav( 500 );
	$productGroupModPopup.fadeOut( 500 );
	$productGroupModPopupContent.css( { "margin-top": "0px" } ).animate( { "margin-top": "-40px" }, 500 );
	
});

// 품목 수정팝업 - 사용 버튼 클릭 이벤트
$productModUseBtn.on("click", function(){
	
	$productModUseBtn.addClass("select");
	$productModUnuseBtn.removeClass("select");
	
});

// 품목 수정팝업 - 미사용 버튼 클릭 이벤트
$productModUnuseBtn.on("click", function(){
	
	$productModUnuseBtn.addClass("select");
	$productModUseBtn.removeClass("select");
	
	
});

// 품목 수정팝업 - 취소 버튼 클릭 이벤트
$productModCancelBtn.on("click", function(){
	
	// 팝업 제거
	parent.showNav( 500 );
	$productModPopup.fadeOut( 500 );
	$productModPopupContent.css( { "margin-top": "0px" } ).animate( { "margin-top": "-40px" }, 500 );
	
});

// 품목그룹 수정팝업 - 완료 버튼 클릭 이벤트
$productGroupModCompleteBtn.on("click", function(){
	
	var newGroupName = $productGroupModNameInp.val().trim();
	if( newGroupName == "" ){
		alert( "품목그룹명이 비어있습니다." );
		return;
	}
	
	// 선택된 소속
	var $selectedGroupItem = $productGroupList.find(".product-group-item.select");
	
	// 그룹명이 달라진 경우만 그룹명 검증
	var beforeGroupName = $selectedGroupItem.getName();
	if( beforeGroupName != newGroupName ){
		var $groupItems = $productGroupList.find( ".product-group-item" );
		for( var i=0; i<$groupItems.length; ++i ){
			var groupName =  $groupItems.eq( i ).getName();
			if( newGroupName == groupName ){
				alert( "이미 존재하는 품목그룹명 입니다." );
				return;
			}
		}
	}
	
	// 소속명 설정
	$selectedGroupItem.setName( newGroupName );
	
	// 사용여부 설정
	var use = $productGroupModUseBtn.hasClass("select");
	$selectedGroupItem.setUse( use );
	
	// 수정일 갱신
	$selectedGroupItem.updateDate();
	
	// 팝업 제거
	parent.showNav( 500 );
	$productGroupModPopup.fadeOut( 500 );
	$productGroupModPopupContent.css( { "margin-top": "0px" } );
	$productGroupModPopupContent.animate( { "margin-top": "-40px" }, 500, function(){
		
		updateProductGroupItemsOrder();
		
	} );
	
});

// 품목 수정팝업 - 완료 버튼 클릭 이벤트
$productModCompleteBtn.on("click", function(){
	
	var newName = $productModNameInp.val().trim();
	if( newName == "" ){
		alert( "품목명이 비어있습니다." );
		return;
	}
	
	// 선택된 소속
	var $selectedItem = $productList.find(".product-group-item.select");
	
	// 그룹명이 달라진 경우만 그룹명 검증
	var beforeName = $selectedItem.getName();
	if( beforeName != newName ){
		var $items = $productList.find( ".product-group-item" );
		for( var i=0; i<$items.length; ++i ){
			var name =  $items.eq( i ).getName();
			if( newName == name ){
				alert( "이미 존재하는 품목명 입니다." );
				return;
			}
		}
	}
	
	// 품목명 설정
	$selectedItem.setName( newName );
	
	// 사용여부 설정
	var use = $productModUseBtn.hasClass("select");
	$selectedItem.setUse( use );
	
	// 수정일 갱신
	$selectedItem.updateDate();
	
	// 팝업 제거
	parent.showNav( 500 );
	$productModPopup.fadeOut( 500 );
	$productModPopupContent.css( { "margin-top": "0px" } );
	$productModPopupContent.animate( { "margin-top": "-40px" }, 500, function(){
		
		updateProductItemsOrder();
		
	} );
	
});

//품목으로 가져오기 버튼 클릭 이벤트
$importProductBtn.on("click", function(){
	
	// 활성화된 경우만 기능 동작
	if( $importProductBtn.hasClass("disable") ){
		return;
	}
	
	// 품목이 존재하는 품목그룹은 추가 불가능
	var $options = $productImportGroupSel.find("option");
	var $items = $productGroupList.find( ".product-group-item" );
	for( var i=0; i<$items.length; ++i ){
		var $item = $items.eq( i );
		$item.updateProductOrder();
		var order = $item.getOrder();
		var id = $item.getId();
		var $option = $options.filter( "[value='"+id+"']" );
	}
	
	// "선택" 선택
	$productImportGroupSel.val( "NO_SELECT" );
	
	// 팝업 표시
	$productImportPopup.fadeIn( 500 );
	parent.hideNav( 500 );
	$productImportPopupContent.css( { "margin-top": "-40px" } ).animate( { "margin-top": "0px" }, 500 );
	
});

//품목 가져오기팝업 - 완료 버튼 클릭 이벤트
$productImportCompleteBtn.on("click", function(){
	
	
	var importParentId = $productImportGroupSel.val();
	if( importParentId == "NO_SELECT" ){
		alert( "품목그룹을 선택하세요." );
		return;
	}
	
	// 선택된 품목그룹
	var $selectedItem = $productGroupList.find(".product-group-item.select");
	var selectedParentId = $selectedItem.getId();
	if( selectedParentId == importParentId ){
		alert( "자신을 품목으로 가져올 수 없습니다." );
		return;
	}
	
	if( 0 < ProductModule.parentChildrenMap[ importParentId ].length ){
		alert( "품목이 없는 품목그룹만 가져올 수 있습니다." );
		return;
	}
	
	// 그룹명이 달라진 경우만 그룹명 검증
	var $importParentItem = ProductModule.map[ importParentId ];
	var importName = $importParentItem.getName();
	var $items = $productList.find( ".product-group-item" );
	for( var i=0; i<$items.length; ++i ){
		var name =  $items.eq( i ).getName();
		if( importName == name ){
			alert( "이미 존재하는 품목명 입니다." );
			return;
		}
	}
	
	// 수정일 갱신
	$importParentItem.updateDate();
	
	
	// 추가
	var $selectedColumn = $selectedItem.data( "$column" );
	$selectedColumn.addClass( "has-children" );
	
	// 기존 컬럼 제거
	var $column = $importParentItem.data( "$column" );
	$column.remove();
	
	// 신규 컬럼생성하여 추가
	var $newColumn = $( $TemplateModule.template[ "product-column-children" ] );
	$newColumn.find(".product-column-name").text( $importParentItem.getName() );
	$newColumn.appendTo( $selectedColumn );
	$importParentItem.data( "$column", $newColumn );
	
	ProductModule.remove( $importParentItem );
	$importParentItem.setParentId( selectedParentId );
	ProductModule.add( $importParentItem );
	
	
	$productCntSpan.update();
	
	// 팝업 제거
	parent.showNav( 500 );
	$productImportPopup.fadeOut( 500 );
	$productImportPopupContent.css( { "margin-top": "0px" } );
	$productImportPopupContent.animate( { "margin-top": "-40px" }, 500, function(){
		
		$importParentItem.animate( { "height": "0px" }, 500, function(){
			
			// 수량 표시 갱신
			$importParentItem.detach();
			$importParentItem.appendTo( $productList );
			$productGroupCntSpan.update();
			$productCntSpan.update();
			$importParentItem.updateProductOrder();
			updateProductGroupItemsOrder();
			$importParentItem.animate( { "height": "37px" }, 500 );
			
		} );
		
	} );
	
});

//품목 수정팝업 - 취소 버튼 클릭 이벤트
$productImportCancelBtn.on("click", function(){
	
	// 팝업 제거
	parent.showNav( 500 );
	$productImportPopup.fadeOut( 500 );
	$productImportPopupContent.css( { "margin-top": "0px" } ).animate( { "margin-top": "-40px" }, 500 );
	
});

// 품목그룹으로 내보내키 버튼 클릭 이벤트
$exportProductBtn.on("click", function(){
	
	// 활성화된 경우만 기능 동작
	if( $exportProductBtn.hasClass("disable") ){
		return;
	}

	// 선택된 품목
	var $selectedItem = $productList.find(".product-group-item.select");
	var newName = $selectedItem.getName();
	
	var $items = $productGroupList.find( ".product-group-item" );
	for( var i=0; i<$items.length; ++i ){
		var name =  $items.eq( i ).getName();
		if( newName == name ){
			alert( "동일한 이름의 품목그룹이 있어 내보내지 못합니다." );
			return;
		}
	}
	
	var $column = $selectedItem.data( "$column" );
	$column.remove();
	
	// 신규 컬럼생성하여 추가
	var $newColumn = $( $TemplateModule.template[ "product-column-parent" ] );
	$newColumn.find(".product-column-name").text( $selectedItem.getName() );
	$newColumn.appendTo( $productColumnList );
	$selectedItem.data( "$column", $newColumn );
	
	$newColumn.appendTo( $productColumnList );
	ProductModule.remove( $selectedItem );
	$selectedItem.setParentId( "TOP" );
	ProductModule.add( $selectedItem );
	
	// 버튼 비활성화
	$exportProductBtn.addClass( "disable" );
	$productModBtn.addClass( "disable" );
	$delProductBtn.addClass( "disable" );
	$selectedItem.removeClass( "select" );
	
	$selectedItem.animate( { "height": "0px" }, 500, function(){
		
		// 수량 표시 갱신
		$selectedItem.detach();
		$productGroupList.append( $selectedItem );
		$productGroupCntSpan.update();
		$productCntSpan.update();
		$selectedItem.updateProductOrder();
		updateProductItemsOrder();
		$selectedItem.animate( { "height": "37px" }, 500 );
		
	} );
	
});

// 저장 버튼 클릭 이벤트
$saveBtn.on("click", function(){

	var groups = [];
	for( var id in ProductModule.map ){
		var $item = ProductModule.map[ id ];
		groups.push( $item.getSaveData() );
	}
	 
	$.ajax({
		
		url: "/product/management/save",
		type: "post",
		headers: {
	    	"Content-Type": "application/json"
	    },
		data: JSON.stringify( groups ),
		dataType: "json",
		success: function( res ){
			 
			if( res.result == "SUCCESS" ){
				alert( "저장되었습니다." );
			}else{
				alert( "실패하였습니다.\n관리자에게 문의바랍니다." );
			}
			 
		}
		 
	});
	
});


function updateBodyHeight(){
	$body.css("height", window.innerHeight + "px");
}
updateBodyHeight();

// 윈도우 크기 변경 이벤트
$window.on("resize", function(){
	updateBodyHeight();
});

</script>
</body>
</html>